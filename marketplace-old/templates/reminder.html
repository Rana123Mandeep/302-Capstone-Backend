{% extends "layout.html" %}

{% block title %}Set Up Meeting - Marketplace{% endblock %}

{% block content %}
<div class="reminder-container">
    <div class="reminder-header">
        <h1>üóìÔ∏è Schedule a Meeting</h1>
        <p>Set up a reminder for your meeting with the seller</p>
    </div>
    
    <div class="reminder-content">
        <div class="product-preview">
            <div class="product-image">
                <img src="{{ url_for('static', filename='uploads/' + product.image_filename) }}" alt="{{ product.title }}">
            </div>
            <div class="product-details">
                <h2>{{ product.title }}</h2>
                <p class="product-price">${{ "%.2f"|format(product.price) }}</p>
                <p class="product-seller">Seller: {{ product.seller.first_name }} {{ product.seller.last_name }}</p>
            </div>
        </div>
        
        <div class="reminder-form-container">
            <form action="{{ url_for('reminder') }}" method="POST" class="reminder-form">
                <input type="hidden" name="product_id" value="{{ product.id }}">
                
                <div class="form-group">
                    <label for="location">Meeting Location:</label>
                    <input type="text" id="location" name="location" placeholder="Enter a safe public meeting location" required>
                    <div class="location-suggestions">
                        <h4>Suggested Safe Meeting Spots:</h4>
                        <div class="suggestion-buttons">
                            <button type="button" class="btn-suggestion" onclick="setLocation('Local Police Station')">Police Station</button>
                            <button type="button" class="btn-suggestion" onclick="setLocation('Shopping Mall Food Court')">Mall Food Court</button>
                            <button type="button" class="btn-suggestion" onclick="setLocation('Coffee Shop')">Coffee Shop</button>
                            <button type="button" class="btn-suggestion" onclick="setLocation('Library')">Library</button>
                            <button type="button" class="btn-suggestion" onclick="setLocation('Grocery Store Parking Lot')">Grocery Store</button>
                        </div>
                    </div>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label for="meeting_date">Meeting Date:</label>
                        <input type="date" id="meeting_date" name="meeting_date" required min="{{ tomorrow.strftime('%Y-%m-%d') }}">
                    </div>
                    
                    <div class="form-group">
                        <label for="meeting_time">Meeting Time:</label>
                        <input type="time" id="meeting_time" name="meeting_time" required>
                    </div>
                </div>
                
                <div class="form-group">
                    <label for="notes">Notes (Optional):</label>
                    <textarea id="notes" name="notes" placeholder="Any additional details about the meeting..."></textarea>
                </div>
                
                <div class="reminder-options">
                    <h3>Reminder Options</h3>
                    <div class="checkbox-group">
                        <label class="checkbox-container">
                            <input type="checkbox" name="email_reminder" checked>
                            <span class="checkmark"></span>
                            Send email reminder
                        </label>
                        
                        <label class="checkbox-container">
                            <input type="checkbox" name="share_with_seller">
                            <span class="checkmark"></span>
                            Share meeting details with seller
                        </label>
                        
                        <label class="checkbox-container">
                            <input type="checkbox" name="add_to_calendar">
                            <span class="checkmark"></span>
                            Add to my calendar
                        </label>
                    </div>
                </div>
                
                <div class="safety-tips">
                    <h3>Safety Tips</h3>
                    <ul>
                        <li>Always meet in public, well-lit places</li>
                        <li>Consider bringing a friend with you</li>
                        <li>Use cash for transactions</li>
                        <li>Inspect the item thoroughly before paying</li>
                        <li>Trust your instincts - if something feels off, leave</li>
                    </ul>
                </div>
                
                <div class="form-actions">
                    <a href="{{ url_for('product_detail', product_id=product.id) }}" class="btn btn-secondary">Cancel</a>
                    <button type="submit" class="btn btn-primary">Set Reminder</button>
                </div>
            </form>
        </div>
    </div>
</div>

<!-- Confirmation Modal -->
<div id="confirmationModal" class="modal" style="display: none;">
    <div class="modal-content">
        <div class="modal-header success">
            <div class="modal-icon">‚úÖ</div>
            <h2>Meeting Scheduled!</h2>
            <span class="close-modal" onclick="closeModal()">‚úï</span>
        </div>
        <div class="modal-body">
            <div class="confirmation-details">
                <h3>Meeting Details:</h3>
                <p><strong>Product:</strong> <span id="confirm-product">{{ product.title }}</span></p>
                <p><strong>Meeting with:</strong> <span id="confirm-seller">{{ product.seller.first_name }} {{ product.seller.last_name }}</span></p>
                <p><strong>Location:</strong> <span id="confirm-location"></span></p>
                <p><strong>Date & Time:</strong> <span id="confirm-datetime"></span></p>
            </div>
            <div class="email-notification">
                <p>‚úâÔ∏è A confirmation email has been sent to you.</p>
                <p>You'll receive a reminder email 24 hours before the meeting.</p>
            </div>
        </div>
        <div class="modal-footer">
            <button class="btn btn-primary" onclick="goToProduct()">Back to Product</button>
        </div>
    </div>
</div>

{% block scripts %}
<script>
    // Set default date to tomorrow
    document.addEventListener('DOMContentLoaded', function() {
        const tomorrow = new Date();
        tomorrow.setDate(tomorrow.getDate() + 1);
        
        const formattedDate = tomorrow.toISOString().split('T')[0];
        document.getElementById('meeting_date').min = formattedDate;
        document.getElementById('meeting_date').value = formattedDate;
        
        // Set default time to noon
        document.getElementById('meeting_time').value = '12:00';
    });
    
    // Set location from suggestions
    function setLocation(location) {
        document.getElementById('location').value = location;
    }
    
    // Form submission and confirmation
    document.querySelector('.reminder-form').addEventListener('submit', function(e) {
        e.preventDefault();
        
        // Get form values for confirmation
        const location = document.getElementById('location').value;
        const date = new Date(document.getElementById('meeting_date').value);
        const time = document.getElementById('meeting_time').value;
        
        // Format date for confirmation
        const options = { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' };
        const formattedDate = date.toLocaleDateString('en-US', options);
        
        // Format time for confirmation
        const [hours, minutes] = time.split(':');
        const timeObj = new Date();
        timeObj.setHours(hours);
        timeObj.setMinutes(minutes);
        const formattedTime = timeObj.toLocaleTimeString('en-US', { hour: 'numeric', minute: '2-digit' });
        
        // Set confirmation values
        document.getElementById('confirm-location').textContent = location;
        document.getElementById('confirm-datetime').textContent = `${formattedDate} at ${formattedTime}`;
        
        // Show confirmation modal
        document.getElementById('confirmationModal').style.display = 'flex';
        
        // In a real application, this is where you would submit the form to the server
        // For now, we're just showing the confirmation modal
        
        // Optionally, reset the form
        this.reset();
        
        // Re-set default values after reset
        document.getElementById('meeting_date').value = tomorrow.toISOString().split('T')[0];
        document.getElementById('meeting_time').value = '12:00';
    });
    
    function closeModal() {
        document.getElementById('confirmationModal').style.display = 'none';
    }
    
    function goToProduct() {
        window.location.href = "{{ url_for('product_detail', product_id=product.id) }}";
    }
    
    // Close modal when clicking outside
    window.onclick = function(event) {
        const modal = document.getElementById('confirmationModal');
        if (event.target === modal) {
            closeModal();
        }
    };
</script>
{% endblock %}
{% endblock %}

{% block head_content %}
<style>
    .reminder-container {
        max-width: 800px;
        margin: 30px auto;
        padding: 0 20px;
    }
    
    .reminder-header {
        text-align: center;
        margin-bottom: 30px;
    }
    
    .reminder-header p {
        color: #666;
        margin-top: 10px;
    }
    
    .reminder-content {
        background: white;
        border-radius: 10px;
        box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        padding: 20px;
        margin-bottom: 30px;
    }
    
    .product-preview {
        display: flex;
        border-bottom: 1px solid #eee;
        padding-bottom: 20px;
        margin-bottom: 20px;
    }
    
    .product-image {
        flex: 0 0 120px;
        height: 120px;
        border-radius: 8px;
        overflow: hidden;
        margin-right: 20px;
    }
    
    .product-image img {
        width: 100%;
        height: 100%;
        object-fit: cover;
    }
    
    .product-details h2 {
        margin-top: 0;
        margin-bottom: 10px;
        font-size: 20px;
    }
    
    .product-price {
        color: #e63946;
        font-weight: bold;
        font-size: 18px;
        margin-bottom: 10px;
    }
    
    .product-seller {
        color: #666;
        margin: 0;
    }
    
    .reminder-form-container {
        margin-top: 20px;
    }
    
    .form-group {
        margin-bottom: 20px;
    }
    
    .form-row {
        display: flex;
        gap: 20px;
    }
    
    .form-row .form-group {
        flex: 1;
    }
    
    label {
        display: block;
        font-weight: bold;
        margin-bottom: 5px;
    }
    
    input[type="text"],
    input[type="date"],
    input[type="time"],
    textarea {
        width: 100%;
        padding: 10px;
        border: 1px solid #ddd;
        border-radius: 5px;
        font-family: inherit;
    }
    
    textarea {
        resize: vertical;
        min-height: 80px;
    }
    
    .location-suggestions {
        margin-top: 10px;
        background: #f9f9f9;
        padding: 10px;
        border-radius: 5px;
    }
    
    .location-suggestions h4 {
        margin: 0 0 10px 0;
        font-size: 14px;
        color: #666;
    }
    
    .suggestion-buttons {
        display: flex;
        flex-wrap: wrap;
        gap: 10px;
    }
    
    .btn-suggestion {
        background: #f0f0f0;
        border: 1px solid #ddd;
        padding: 5px 10px;
        border-radius: 3px;
        font-size: 13px;
        cursor: pointer;
        transition: background 0.2s;
    }
    
    .btn-suggestion:hover {
        background: #e0e0e0;
    }
    
    .reminder-options, .safety-tips {
        margin-bottom: 20px;
    }
    
    .reminder-options h3, .safety-tips h3 {
        font-size: 16px;
        margin-top: 0;
        margin-bottom: 10px;
        border-bottom: 1px solid #eee;
        padding-bottom: 5px;
    }
    
    .checkbox-group {
        display: flex;
        flex-direction: column;
        gap: 10px;
    }
    
    .checkbox-container {
        display: flex;
        align-items: center;
        cursor: pointer;
        user-select: none;
    }
    
    .checkbox-container input {
        margin-right: 10px;
    }
    
    .safety-tips ul {
        margin: 0;
        padding-left: 20px;
    }
    
    .safety-tips li {
        margin-bottom: 5px;
        color: #666;
    }
    
    .form-actions {
        display: flex;
        justify-content: flex-end;
        gap: 10px;
        margin-top: 20px;
    }
    
    /* Modal */
    .modal {
        display: none;
        position: fixed;
        z-index: 1000;
        left: 0;
        top: 0;
        width: 100%;
        height: 100%;
        background: rgba(0,0,0,0.5);
        justify-content: center;
        align-items: center;
    }
    
    .modal-content {
        background: white;
        border-radius: 10px;
        width: 90%;
        max-width: 500px;
        box-shadow: 0 5px 15px rgba(0,0,0,0.3);
    }
    
    .modal-header {
        display: flex;
        align-items: center;
        padding: 15px 20px;
        border-bottom: 1px solid #eee;
    }
    
    .modal-header.success {
        background: #d4edda;
    }
    
    .modal-icon {
        margin-right: 10px;
        font-size: 24px;
    }
    
    .modal-header h2 {
        margin: 0;
        flex: 1;
        color: #155724;
    }
    
    .close-modal {
        font-size: 24px;
        cursor: pointer;
        color: #155724;
    }
    
    .modal-body {
        padding: 20px;
    }
    
    .confirmation-details {
        margin-bottom: 20px;
    }
    
    .confirmation-details h3 {
        margin-top: 0;
        font-size: 18px;
    }
    
    .confirmation-details p {
        margin: 5px 0;
    }
    
    .email-notification {
        background: #f8f9fa;
        padding: 10px 15px;
        border-radius: 5px;
        border-left: 4px solid #007bff;
        margin-top: 15px;
    }
    
    .email-notification p {
        margin: 5px 0;
        color: #666;
    }
    
    .modal-footer {
        padding: 15px 20px;
        border-top: 1px solid #eee;
        text-align: right;
    }
    
    @media (max-width: 768px) {
        .product-preview {
            flex-direction: column;
        }
        
        .product-image {
            margin-right: 0;
            margin-bottom: 15px;
            height: 200px;
        }
        
        .form-row {
            flex-direction: column;
            gap: 0;
        }
    }
</style>
{% endblock %}
